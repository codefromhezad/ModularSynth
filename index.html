<!doctype html>
<html>
	<head>
		<meta charset="utf-8">
		<title>Websynth</title>

		<link type="text/css" rel="stylesheet" href="js/vendors/jquery-ui/jquery-ui.min.css">
		<link type="text/css" rel="stylesheet" href="css/app.css">

		<script src="js/vendors/jquery-2.2.0.min.js"></script>
		<script src="js/vendors/jquery-ui/jquery-ui.min.js"></script>
		<script src="js/Harmony.js"></script>

		<script src="js/AudioModule.js"></script>
		<script src="js/AudioModule.VCO.js"></script>
		<script src="js/AudioModule.VCA.js"></script>
		<script src="js/AudioModule.MasterOutput.js"></script>
	</head>
	<body>

		<div class="synth-pad">
			<a href="#" data-note="A4"></a>
			<a href="#" data-note="A#4" class="sharp"></a>
			<a href="#" data-note="B4"></a>
			<a href="#" data-note="C4"></a>
		</div>

		<div class="available-modules">
			<h4>Available modules</h4>
			<a href="#" class="module-icon module-vca" title="Gain node - Amplify input to output" data-slug="VCA">VCA</a>
			<a href="#" class="module-icon module-vco" title="Oscillator node - Generate an oscillating signal" data-slug="VCO">VCO</a>
		</div>

		<div id="websynth-canvas"></div>

		<script>

			AudioModule.boot();

			$( function() {
				
				$('.available-modules').on('click', 'a.module-icon', function(e) {
					var slug = $(this).attr('data-slug');
					var $widget = AudioModule.UI.spawnModule(slug);

					if( $widget ) {
						$(AudioModule.UI.containerSelector).append($widget);
					}
				});

				$('.synth-pad a').on('mousedown', function(e) {
					e.preventDefault();

					var note = $(this).attr('data-note');
					var freq = Harmony.noteToFreq(note);

					var oscIndex = vco.start(freq);

					$(this).attr('data-osc-index', oscIndex);

					return false;
				});

				$('.synth-pad a').on('mouseup', function(e) {
					e.preventDefault();

					var oscIndex = $(this).attr('data-osc-index');
					vco.stop(oscIndex);

					$(this).attr('data-osc-index', null);

					return false;
				});
			});
		</script>
	</body>
</html>